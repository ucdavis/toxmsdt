"use strict";(self.wpRiseJsonp=self.wpRiseJsonp||[]).push([["profiler"],{31670:(e,n,t)=>{t.r(n),t.d(n,{DEFAULT_RUM_PROFILER_CONFIGURATION:()=>v,createRumProfiler:()=>g});var i=t(92385),s=t(67173),r=t(85839),o=t(22747),a=t(62220),c=t(68263);const l=new Map;let u=!1;function f(e){if(!(!1===u||e.startTime<u))return l.get(e.startTime)}function p({rawRumEvent:e,startTime:n}){if("long_task"!==e.type)return;!function(e,n){l.set(n,e)}(e.long_task.id,n)}var d=t(78394);const m={sendProfile:(e,n,t,i)=>{const s=function(e,n,t,i){const s=n.tags,r=function(e,n,t){const i={application:{id:n}};t&&(i.session={id:t});const s=Array.from(new Set(e.views.map((e=>e.viewId))));s.length&&(i.view={id:s});const r=e.longTasks.map((e=>f(e))).filter((e=>void 0!==e));r.length&&(i.long_task={id:r});return i}(e,t,i),o=function(e){const n=e.concat(["language:javascript","runtime:chrome","family:chrome","host:browser"]);return n}(s),a=new Date(e.timeOrigin+e.startTime),c=new Date(e.timeOrigin+e.endTime);return{...r,attachments:["wall-time.json"],start:a.toISOString(),end:c.toISOString(),family:"chrome",runtime:"chrome",format:"json",version:4,tags_profiler:o.join(",")}}(e,n,t,i),r=function(e,n){const t=new Blob([JSON.stringify(e)],{type:"application/json"}),i=new FormData;return i.append("event",new Blob([JSON.stringify(n)],{type:"application/json"}),"event.json"),i.append("wall-time.json",t,"wall-time.json"),{data:i,bytesCount:0}}(e,s),o=n.build("fetch",r);return(0,d.A2)("Sending profile to public profiling intake",{profilingIntakeURL:o,applicationId:t,sessionId:i}),fetch(o,{body:r.data,method:"POST"})}},v={sampleIntervalMs:10,collectIntervalMs:6e4,minProfileDurationMs:5e3,minNumberOfSamples:50};function g(e,n,t,d=v){const g=(0,c.s5)(c.do.LONG_ANIMATION_FRAME);let w;const h=[];let b={state:"stopped"};function T(t){if("running"===t.state)return{cleanupTasks:t.cleanupTasks,observer:t.observer};const i=[];let s;if(e.trackLongTasks){s=new PerformanceObserver(S),s.observe({entryTypes:[g?"long-animation-frame":"longtask"]});const e=n.subscribe(12,(e=>{p(e)}));u=performance.now(),i.push((()=>null==s?void 0:s.disconnect())),i.push(e.unsubscribe)}const r=n.subscribe(2,(e=>{M({viewId:e.id,viewName:e.name,startTime:e.startClocks.relative})}));return i.push(r.unsubscribe),{cleanupTasks:i,observer:s}}function y(){const e=(0,s.V)().Profiler;if(!e)throw new Error("RUM Profiler is not supported in this browser.");I(b).catch(r.Dx);const{cleanupTasks:n,observer:t}=T(b);let i;try{i=new e({sampleInterval:d.sampleIntervalMs,maxBufferSize:Math.round(1.5*d.collectIntervalMs/d.sampleIntervalMs)})}catch(e){return void o.Vy.warn("[DD_RUM] Profiler startup failed. Ensure your server includes the `Document-Policy: js-profiling` response header when serving HTML pages.",e)}b={state:"running",startTime:performance.now(),profiler:i,timeoutId:(0,a.wg)(y,d.collectIntervalMs),longTasks:[],views:[],cleanupTasks:n,observer:t},M(w),i.addEventListener("samplebufferfull",O)}async function I(n){var i,s;if("running"!==n.state)return;D(null!==(s=null===(i=n.observer)||void 0===i?void 0:i.takeRecords())&&void 0!==s?s:[]),(0,a.DJ)(n.timeoutId),n.profiler.removeEventListener("samplebufferfull",O);const{startTime:o,longTasks:c,views:f}=n,p=performance.now();await n.profiler.stop().then((n=>{const i=performance.now(),s=c.length>0,a=i-o<d.minProfileDurationMs,v=function(e){let n=0;for(const t of e)void 0!==t.stackId&&n++;return n}(n.samples)<d.minNumberOfSamples;(s||!a&&!v)&&(function(n){var i;const s=null===(i=t.findTrackedSession())||void 0===i?void 0:i.id;m.sendProfile(n,e.profilingEndpointBuilder,e.applicationId,s).catch(r.Dx)}(Object.assign(n,{startTime:o,endTime:i,timeOrigin:performance.timeOrigin,longTasks:c,views:f,sampleInterval:d.sampleIntervalMs})),function(e){if(!(!1===u||e<u))for(const n of l.keys())n<e&&l.delete(n)}(p))})).catch(r.Dx)}async function k(e){"running"===b.state&&(b.cleanupTasks.forEach((e=>e())),await I(b),b={state:e})}function M(e){"running"===b.state&&e&&b.views.push(e)}function O(){y()}function S(e){D(e.getEntries())}function D(e){if("running"===b.state)for(const n of e)n.duration<d.sampleIntervalMs||b.longTasks.push({id:f(n),duration:n.duration,entryType:n.entryType,startTime:n.startTime})}function R(){"hidden"===document.visibilityState&&"running"===b.state?k("paused").catch(r.Dx):"visible"===document.visibilityState&&"paused"===b.state&&y()}function P(){y()}return{start:function(n){"running"!==b.state&&(w=n?{startTime:n.startClocks.relative,viewId:n.id,viewName:n.name}:void 0,h.push((0,i.q)(e,window,"visibilitychange",R).stop,(0,i.q)(e,window,"beforeunload",P).stop),y())},stop:async function(){await k("stopped"),u=!1,l.clear(),h.forEach((e=>e()))},isStopped:function(){return"stopped"===b.state},isRunning:function(){return"running"===b.state},isPaused:function(){return"paused"===b.state}}}}}]);